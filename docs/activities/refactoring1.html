<!DOCTYPE html>
<html>
<head>
  <link href='https://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Refactoring Activity 1 (CS 321)</title>
  <style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet" href="https://skiadas.github.io/css/course.css" type="text/css" />
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>
<body>
<h1 id="refactoring-activity-1-renaming-variables-and-extracting-classes">Refactoring Activity 1: Renaming Variables and Extracting Classes</h1>
<h2 id="goals">Goals</h2>
<ul>
<li>Learn important vocabulary:
<ul>
<li>intention action (a.k.a. intention)</li>
<li></li>
</ul></li>
<li>Learn how to accomplish the following refactorings in IntelliJ:
<ul>
<li>variable renaming</li>
<li></li>
</ul></li>
<li>Develop these habits:
<ul>
<li>use <code>&lt;ctrl&gt;-T</code> to open “Refactor This” menu</li>
<li>use <code>&lt;option&gt;-ENTER</code> to see available intentions</li>
</ul></li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<ul>
<li><p><input type="checkbox" disabled="" />
Download <code>primeGenerator.zip</code> from the <code>Refactoring Activity 1-3</code> folder on Moodle (right-click and save file to your CS321 directory).</p></li>
<li><p><input type="checkbox" disabled="" />
In a terminal window, navigate to your CS321 directory and run: <code>unzip primeGenerator.zip</code></p></li>
<li><p><input type="checkbox" disabled="" />
Start IntelliJ and select <code>File -&gt; New -&gt; Project from Existing Sources</code>. Navigate to and select the <code>primeGenerator</code> folder that you just unzipped.</p></li>
<li><p><input type="checkbox" disabled="" />
Verify that you have all three project files:</p><ul>
<li>PrimePrinter.java</li>
<li>PrintPrimesTest.java</li>
<li>gold</li>
</ul></li>
<li><p><input type="checkbox" disabled="" />
Right-click on <code>PrintPrimesTest</code> (either the filename or the tab) and select: <code>Run 'PrintPrimesTest'</code>. If the test does not pass, ask for help.</p></li>
<li><p><input type="checkbox" disabled="" />
Take a look at the <code>PrimePrinter</code> file and its <code>main</code> method. This is the method we will refactor and clean up.</p></li>
</ul>
<h2 id="step-1-variable-renaming">Step 1: Variable Renaming</h2>
<ol>
<li>The first and easiest thing to fix are the variable names. The table below lists the variables used by the program. For each variable, read the description of what the variable represents and choose a better name for the variable. Note that for some variables, it is how the name is formatted rather than the name itself that can be improved (e.g., camel-case instead of all-caps).</li>
</ol>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="header">
<th>New Name</th>
<th>Current Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>M</td>
<td>number of primes to generate and print</td>
</tr>
<tr class="even">
<td></td>
<td>RR</td>
<td>number of rows to print per page</td>
</tr>
<tr class="odd">
<td></td>
<td>CC</td>
<td>number of columns to print per page</td>
</tr>
<tr class="even">
<td></td>
<td>ORDMAX</td>
<td>Leave as is, but make lower case (TODO: come back to it?)</td>
</tr>
<tr class="odd">
<td></td>
<td>P</td>
<td>list of primes</td>
</tr>
<tr class="even">
<td></td>
<td>PAGENUMBER</td>
<td>current page number in the printout</td>
</tr>
<tr class="odd">
<td></td>
<td>PAGEOFFSET</td>
<td>offset into the primes array where the current page starts</td>
</tr>
<tr class="even">
<td></td>
<td>ROWOFFSET</td>
<td>offset into the primes array where the elements in the current row start</td>
</tr>
<tr class="odd">
<td></td>
<td>C</td>
<td>current column in the printout</td>
</tr>
<tr class="even">
<td></td>
<td>J</td>
<td>candidate prime number</td>
</tr>
<tr class="odd">
<td></td>
<td>K</td>
<td>index into the prime array for the last computed prime</td>
</tr>
<tr class="even">
<td></td>
<td>JPRIME</td>
<td>boolean that indicates whether the candidate number (J) is “possibly prime” (<code>false</code> means definitely not prime).</td>
</tr>
<tr class="odd">
<td></td>
<td>ORD</td>
<td>Leave as is, just lowercase. (TODO: come back to it?)</td>
</tr>
<tr class="even">
<td></td>
<td>SQUARE</td>
<td>next possible prime square (TODO: come back to it?)</td>
</tr>
<tr class="odd">
<td></td>
<td>N</td>
<td>Leave as is, just lowercase (TODO: come back to it?)</td>
</tr>
<tr class="even">
<td></td>
<td>MULT</td>
<td>an array of multiples</td>
</tr>
</tbody>
</table>
<ol>
<li><p>Rename each variable in <code>PrimePrinter.java</code> as follows:</p>
<ol>
<li>Click on the variable name</li>
<li>Use <code>&lt;ctrl&gt;-T</code> to open “Refactor This”</li>
<li>Choose <code>Rename</code> (the variable will then be outlined in red)</li>
<li>Type in the new name for the variable</li>
<li><code>ENTER</code> to make the change</li>
</ol>
<p>Notice that all occurrences of the original variable name have been renamed.</p></li>
<li><p>Use <code>Code -&gt; Reformat Code</code> to automatically fix the indentation and spacing.</p></li>
<li><p>The last thing to do is to move the variable declarations closer to where the variables are first used. For each variable declaration, do the following:</p>
<ol>
<li>Click on a variable name</li>
<li>Use <code>&lt;option&gt;-ENTER</code> to show available intentions</li>
<li>Select <code>Move declaration closer to usages</code> if that is one of the possible intentions in the list</li>
</ol></li>
</ol>
<p>Test (TODO: add commit?)</p>
<h2 id="step-2-basic-method-separation">Step 2: Basic Method separation</h2>
<p>Looking at the code, we can see that it splits in broadly two parts:</p>
<ul>
<li>The lines up to the end of the first <code>while</code> loop, that seem to do with computing the prime numbers.</li>
<li>The lines after the first <code>while</code> loop, starting with the page number initialization, which seem to have to do with printing the numbers.</li>
</ul>
<p>Select each while loop in turn, and use <code>extract method</code> on them. One method should be called <code>generatePrimes</code> while the other should be called <code>printNumbers</code>.</p>
<p>If there are any variables that are not being used right now (grayed out), use the “Remove variable” intention to eliminate them.</p>
<p>Run your tests to make sure they still run.</p>
<p>You should now have been left with about a dozen variables defined near the top of the <code>main</code> method, then passed into the two extracted methods. Let’s think about these variables. They fall broadly in two categories:</p>
<ul>
<li>Some variables are clearly “global constants”, settings that the user might want to adjust, namely: the number of primes to print, the number of rows per page and the number of columns per page.</li>
<li>Others are used by the “generate primes” function in order for it to do its work. These are: ordmax, the multiples array, the candidate prime, the index into the prime array, ord, and the square. We really would like all of those to be local variables within the “generate primes” function, but they did not end up there.</li>
</ul>
<p>In order to get this second group of variables into the function, there are a couple of ways but the simplest is to just undo our last step:</p>
<ul>
<li>Use the “Inline” refactoring to inline and remove the generate primes function. We will create it again in a moment.</li>
<li>Use the “Move declaration closer to usage” intention, or simply move line-by-line, to move all the declarations of variables that we want to go as part of the “generate primes” function right next to the corresponding while loop.</li>
<li>Select the while loop, along with all those variable declarations, including the primes array declaration and the <code>primes[1]=2</code> part, and perform the “extract Method” refactoring. If you do this correctly, you should see only one parameter on this new method, namely the number of primes. And the method should be set to return the primes array.</li>
</ul>
<p>Test (TODO: and commit?)</p>
<h2 id="step-3-extracting-classes">Step 3: Extracting Classes</h2>
<p>The two methods we have are a good start: They each handle a specific and disjoint set of variables. But they are still quite large. It also feels like they are dealing with two completely separate tasks: One is concerned with generating a list of prime numbers, the other is concerned with simply printing out numbers.</p>
<p>This suggests that the two methods should really belong in different classes, and perhaps should each form the basis for those new classes. We will now create these classes.</p>
<ul>
<li>Select the “generate primes” function call and perform the “extract Method object” refactoring. Make sure to ask it to move the method as well when asked. Call the new class <code>PrimeGenerator</code>.</li>
<li>This was likely created as an inner class to the PrimePrinter class, but we would ideally like it to be its own class. Select the class and perform a “Move” refactoring to move it to the upper level.</li>
<li>Now take a look at the newly created object. It has a <code>generatePrimes</code> method that is really no longer needed as its own method. We would rather keep the <code>invoke</code> method, maybe rename it later. So select the `generateNumbers function and perform the “inline” refactoring and remove the method.</li>
<li>Now rename the <code>invoke</code> method to <code>generatePrimes</code>.</li>
</ul>
<p>Run the test to make sure it still works.</p>
<p>Of course we’re far from done with that class: It still consists of one large method, we’ll need to do something about that.</p>
<p>Now it is time to consider the number-printing function. Take a moment to look at its parameters:</p>
<ul>
<li>The rows per page and columns per page variable feel like they should be part of the initialization of the new class: When you create a number-printer, you should be specifying how many rows and columns you want it to print.</li>
<li>The primes and number of primes parameters feel more elements you should be providing to the number-printer when you call its <code>invoke</code> or <code>print</code> method.</li>
</ul>
<p>We want to achieve this separation. For this reason, we will use a different refactoring to form the new class. Here are the steps for this:</p>
<ul>
<li>Select the print-numbers method call, and do the “extract Parameter object” refactoring. Select only the two rows and columns parameters for it, and put <code>NumberPrinter</code> as the class name (make sure you set it to Create New Class). This should turn the print-numbers function into a three parameter function, one of those parameters being a <code>NumberPrinter</code> instance.</li>
<li>Perform the “Convert to instance method” refactoring, to turn the print-numbers method into an instance method of the <code>NumberPrinter</code> instance.</li>
<li>Looking at the <code>NumberPrinter</code> class now, we see that IntelliJ has “encapsulated” the two fields behind getter methods. We don’t really need that, so select each method and perform an <code>inline</code> refactoring to remove them.</li>
</ul>
<p>Now our main method should look particularly simple: Initialize a few parameters, create a prime number generator and call it, and create a number printer and call it with the primes. Let’s do some refactoring to clean it up though:</p>
<ul>
<li>Select the <code>new NumberPrinter(...)</code> call (without the <code>printNumbers</code> part), and perform extract local variable from it to create a <code>numberPrinter</code> local variable.</li>
<li>Select the <code>new PrimeGenerator(...)</code> call (without the <code>generatePrimes</code> part), and perform extract local variable from it to create a <code>primeGenerator</code> local variable.</li>
<li>Select the <code>primes</code> array and choose the <code>inline</code> refactoring to inline construction into its use.</li>
<li>Looking at it here, let’s rename the <code>printNumbers</code> method to just <code>print</code> and the <code>generatePrimes</code> method to just <code>generate</code>. Remember to use the Rename refactoring for this!</li>
</ul>
<p>Run your tests.</p>
<p>This activity continues in <a href="refactoring2.html">refactoring activity 2</a>.</p>
</body>
</html>
